<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Granny‚Äôs Backpack - Granny Bean Adventure</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            background: linear-gradient(to bottom, #f4d03f, #f39c12);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            color: #333;
        }
        #game-container {
            position: relative;
            width: 90vw;
            height: 90vh;
            max-width: 800px;
            max-height: 600px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 20px;
            overflow: hidden;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        #title {
            font-size: 2em;
            color: #ff9900;
            margin: 10px;
            font-style: italic;
        }
        #granny {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 5em;
            line-height: 1;
        }
        #backpack {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 250px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 10em;
            color: #8b4513;
            z-index: 10;
        }
        #backpack .letter {
            position: absolute;
            font-size: 0.3em;
            color: white;
            background: #a0522d;
            padding: 10px;
            border-radius: 50%;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .item {
            position: absolute;
            width: 120px;
            height: 150px;
            cursor: pointer;
            background: #fff;
            border: 2px solid #ddd;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 1em;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 5;
            transition: transform 0.2s;
        }
        .item .image {
            font-size: 4em;
            margin-bottom: 5px;
        }
        .item .word {
            font-size: 0.8em;
        }
        #timer {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5em;
            color: #333;
        }
        #hint {
            position: absolute;
            bottom: 300px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.2em;
            color: #ff0000;
            display: none;
            background: rgba(255,255,255,0.8);
            padding: 10px;
            border-radius: 10px;
            max-width: 80%;
        }
        #progress {
            position: absolute;
            top: 50px;
            right: 10px;
            font-size: 1em;
            color: #333;
        }
        #startButton {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5em;
            padding: 15px 30px;
            background-color: #ffcc66;
            color: #333;
            border: 4px solid #ff9900;
            border-radius: 15px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            font-weight: bold;
            text-align: center;
            width: 200px;
            transition: transform 0.2s, background-color 0.2s;
        }
        #startButton:hover, #startButton:active {
            transform: translate(-50%, -50%) scale(1.05);
            background-color: #ffb84d;
        }
        @keyframes bounce {
            0% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
            100% { transform: translateY(0); }
        }
        @media (max-width: 600px) {
            .item {
                width: 100px;
                height: 120px;
            }
            .item .image {
                font-size: 3em;
            }
            #backpack {
                width: 150px;
                height: 200px;
                font-size: 8em;
            }
            #backpack .letter {
                font-size: 0.4em;
                padding: 8px;
            }
            #title {
                font-size: 1.5em;
            }
            #timer {
                font-size: 1.2em;
            }
            #hint {
                bottom: 220px;
                font-size: 1em;
            }
            #granny {
                font-size: 3em;
            }
            .item {
                top: auto;
                bottom: 300px;
            }
            #startButton {
                font-size: 1.2em;
                padding: 10px 20px;
                width: 150px;
            }
            #startButton:hover, #startButton:active {
                transform: translate(-50%, -50%) scale(1.05);
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="title">Granny‚Äôs Backpack</div>
        <div id="granny">üë©‚Äçü¶±</div>
        <div id="backpack"></div>
        <div id="timer">Time: 60</div>
        <div id="hint"></div>
        <div id="progress">Packed: 0/0</div>
        <div id="startButton" onclick="initAndStart()">Tap to Start!</div>
    </div>
    <audio id="correctSound" src="sounds/ding.mp3" preload="auto"></audio>
    <audio id="wrongSound" src="sounds/boing.mp3" preload="auto"></audio>

    <script>
        const itemsData = {
            "A": {"correct": [{"emoji": "üçé", "word": "Apple"}, {"emoji": "üêú", "word": "Ant"}], "wrong": [{"emoji": "‚öΩ", "word": "Ball"}, {"emoji": "üê±", "word": "Cat"}]},
            "B": {"correct": [{"emoji": "‚öΩ", "word": "Ball"}, {"emoji": "üéà", "word": "Balloon"}, {"emoji": "ü¶á", "word": "Bat"}], "wrong": [{"emoji": "üçé", "word": "Apple"}]},
            "C": {"correct": [{"emoji": "üç∞", "word": "Cake"}, {"emoji": "üïØÔ∏è", "word": "Candle"}], "wrong": [{"emoji": "‚öΩ", "word": "Ball"}, {"emoji": "üêª", "word": "Bear"}]},
            "D": {"correct": [{"emoji": "üê∂", "word": "Dog"}, {"emoji": "üö™", "word": "Door"}, {"emoji": "ü•Å", "word": "Drum"}], "wrong": [{"emoji": "üç∞", "word": "Cake"}]},
            "E": {"correct": [{"emoji": "ü•ö", "word": "Egg"}, {"emoji": "üêò", "word": "Elephant"}], "wrong": [{"emoji": "üê∂", "word": "Dog"}, {"emoji": "üö™", "word": "Door"}]},
            "F": {"correct": [{"emoji": "üêü", "word": "Fish"}, {"emoji": "üå∏", "word": "Flower"}, {"emoji": "üèà", "word": "Football"}], "wrong": [{"emoji": "ü•ö", "word": "Egg"}]},
            "G": {"correct": [{"emoji": "üéÆ", "word": "Game"}, {"emoji": "üóëÔ∏è", "word": "Garbage"}], "wrong": [{"emoji": "üêü", "word": "Fish"}, {"emoji": "üå∏", "word": "Flower"}]},
            "H": {"correct": [{"emoji": "üé©", "word": "Hat"}, {"emoji": "üè†", "word": "House"}, {"emoji": "‚ù§Ô∏è", "word": "Heart"}], "wrong": [{"emoji": "üéÆ", "word": "Game"}]},
            "I": {"correct": [{"emoji": "üç®", "word": "Ice Cream"}, {"emoji": "üßä", "word": "Ice"}], "wrong": [{"emoji": "üé©", "word": "Hat"}, {"emoji": "üè†", "word": "House"}]},
            "J": {"correct": [{"emoji": "üé≤", "word": "Jacks"}, {"emoji": "üéÉ", "word": "Jack-o-lantern"}], "wrong": [{"emoji": "üç®", "word": "Ice Cream"}, {"emoji": "üßä", "word": "Ice"}]},
            "K": {"correct": [{"emoji": "ü¶ò", "word": "Kangaroo"}, {"emoji": "üçÖ", "word": "Ketchup"}, {"emoji": "üîë", "word": "Key"}], "wrong": [{"emoji": "üé≤", "word": "Jacks"}]},
            "L": {"correct": [{"emoji": "ü¶Å", "word": "Lion"}, {"emoji": "üîí", "word": "Lock"}], "wrong": [{"emoji": "ü¶ò", "word": "Kangaroo"}, {"emoji": "üçÖ", "word": "Ketchup"}]},
            "M": {"correct": [{"emoji": "üêí", "word": "Monkey"}, {"emoji": "üåï", "word": "Moon"}], "wrong": [{"emoji": "ü¶Å", "word": "Lion"}, {"emoji": "üîí", "word": "Lock"}]},
            "N": {"correct": [{"emoji": "ü™π", "word": "Nest"}, {"emoji": "üì∞", "word": "Newspaper"}, {"emoji": "üåô", "word": "Night"}], "wrong": [{"emoji": "üêí", "word": "Monkey"}]},
            "O": {"correct": [{"emoji": "üêô", "word": "Octopus"}, {"emoji": "ü¶¶", "word": "Otter"}], "wrong": [{"emoji": "ü™π", "word": "Nest"}, {"emoji": "üì∞", "word": "Newspaper"}]},
            "P": {"correct": [{"emoji": "‚úèÔ∏è", "word": "Pencil"}, {"emoji": "üçï", "word": "Pizza"}], "wrong": [{"emoji": "üêô", "word": "Octopus"}, {"emoji": "ü¶¶", "word": "Otter"}]},
            "Q": {"correct": [{"emoji": "üë∏", "word": "Queen"}, {"emoji": "‚ùì", "word": "Question"}, {"emoji": "ü™∂", "word": "Quill"}], "wrong": [{"emoji": "‚úèÔ∏è", "word": "Pencil"}]},
            "R": {"correct": [{"emoji": "üê∞", "word": "Rabbit"}, {"emoji": "üåà", "word": "Rainbow"}], "wrong": [{"emoji": "üë∏", "word": "Queen"}, {"emoji": "‚ùì", "word": "Question"}]},
            "S": {"correct": [{"emoji": "üêç", "word": "Snake"}, {"emoji": "‚≠ê", "word": "Star"}], "wrong": [{"emoji": "üê∞", "word": "Rabbit"}, {"emoji": "üåà", "word": "Rainbow"}]},
            "T": {"correct": [{"emoji": "‚õ∫", "word": "Tent"}, {"emoji": "üå≥", "word": "Tree"}, {"emoji": "üöú", "word": "Tractor"}], "wrong": [{"emoji": "üêç", "word": "Snake"}]},
            "U": {"correct": [{"emoji": "‚òÇÔ∏è", "word": "Umbrella"}, {"emoji": "ü¶Ñ", "word": "Unicorn"}], "wrong": [{"emoji": "‚õ∫", "word": "Tent"}, {"emoji": "üå≥", "word": "Tree"}]},
            "V": {"correct": [{"emoji": "üöê", "word": "Van"}, {"emoji": "ü•ï", "word": "Vegetable"}], "wrong": [{"emoji": "‚òÇÔ∏è", "word": "Umbrella"}, {"emoji": "ü¶Ñ", "word": "Unicorn"}]},
            "W": {"correct": [{"emoji": "üíß", "word": "Water"}, {"emoji": "üçâ", "word": "Watermelon"}, {"emoji": "‚åö", "word": "Watch"}], "wrong": [{"emoji": "üöê", "word": "Van"}]},
            "X": {"correct": [{"emoji": "ü©ª", "word": "X-ray"}, {"emoji": "ü™á", "word": "Xylophone"}], "wrong": [{"emoji": "üíß", "word": "Water"}, {"emoji": "üçâ", "word": "Watermelon"}]},
            "Y": {"correct": [{"emoji": "üß∂", "word": "Yarn"}, {"emoji": "üü°", "word": "Yellow"}], "wrong": [{"emoji": "ü©ª", "word": "X-ray"}, {"emoji": "ü™á", "word": "Xylophone"}]},
            "Z": {"correct": [{"emoji": "ü¶ì", "word": "Zebra"}, {"emoji": "ü§ê", "word": "Zipper"}], "wrong": [{"emoji": "üß∂", "word": "Yarn"}, {"emoji": "üü°", "word": "Yellow"}]}
        };

        let currentLetterIndex = 0;
        const letters = Object.keys(itemsData);
        let targetLetter = letters[currentLetterIndex];
        let timeLeft = 60;
        let timerInterval;
        let score = 0;
        let requiredCorrect = 0;

        let audioContext = null;

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            } else if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
        }

        function playCorrectSound() {
            initAudio();
            const audio = document.getElementById('correctSound');
            audio.volume = 0.5;
            audio.currentTime = 0;
            console.log("Playing correct sound");
            audio.play().catch(e => console.log("Audio play failed:", e));
        }

        function playWrongSound() {
            initAudio();
            const audio = document.getElementById('wrongSound');
            audio.volume = 0.5;
            audio.currentTime = 0;
            console.log("Playing wrong sound");
            audio.play().catch(e => console.log("Audio play failed:", e));
        }

        function initAndStart() {
            initAudio();
            startGame();
            document.getElementById('startButton').style.display = 'none';
        }

        function startGame() {
            document.getElementById('title').innerText = `Pack for ${targetLetter}!`;
            document.getElementById('backpack').innerHTML = 'üéí<span class="letter">' + targetLetter + '</span>';
            loadItems();
            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').innerText = `Time: ${timeLeft}`;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    alert('Time‚Äôs up! Moving to next letter.');
                    nextLevel();
                }
            }, 1000);
        }

        function loadItems() {
            const container = document.getElementById('game-container');
            const currentItems = document.querySelectorAll('.item');
            currentItems.forEach(item => container.removeChild(item));

            const data = itemsData[targetLetter];
            let allItems = [...data.correct, ...data.wrong];
            allItems.sort(() => Math.random() - 0.5);
            const itemsToUse = allItems.slice(0, 4);

            requiredCorrect = data.correct.length;
            score = 0;
            document.getElementById('progress').innerText = `Packed: 0/${requiredCorrect}`;

            const isMobile = window.innerWidth <= 600;
            const containerWidth = container.clientWidth;
            const containerHeight = container.clientHeight;
            const rows = isMobile ? Math.ceil(itemsToUse.length / 2) : 1;
            const itemWidth = isMobile ? 100 : 120;
            const itemHeight = isMobile ? 120 : 150;
            const startTop = 100;
            const maxTop = containerHeight - 300;

            itemsToUse.forEach((obj, index) => {
                const item = document.createElement('div');
                item.className = 'item';
                item.id = `item-${index}`;
                item.onclick = () => packItem(item);
                item.innerHTML = `<span class="image">${obj.emoji}</span><span class="word">${obj.word}</span>`;
                item.dataset.letter = obj.word[0].toUpperCase();

                if (isMobile) {
                    const col = index % 2;
                    const row = Math.floor(index / 2);
                    item.style.left = `${(containerWidth / 2) * col + (containerWidth / 4) - (itemWidth / 2)}px`;
                    item.style.top = `${startTop + row * (itemHeight + 20)}px`;
                    if (item.getBoundingClientRect().bottom > containerHeight - 250) {
                        item.style.top = `${containerHeight - 250 - (row * (itemHeight + 20))}px`;
                    }
                } else {
                    item.style.left = `${(containerWidth / itemsToUse.length) * index + (containerWidth / (itemsToUse.length * 2)) - (itemWidth / 2)}px`;
                    item.style.top = `${startTop}px`;
                }

                container.appendChild(item);
            });
        }

        function packItem(item) {
            if (item.dataset.letter === targetLetter) {
                item.style.display = 'none';
                score++;
                document.getElementById('progress').innerText = `Packed: ${score}/${requiredCorrect}`;
                playCorrectSound();
                if (score >= requiredCorrect) {
                    clearInterval(timerInterval);
                    playCorrectSound();
                    setTimeout(() => {
                        alert(`Yay! You packed all the right things for ${targetLetter}! Great job! Moving to the next letter.`);
                        nextLevel();
                    }, 100);
                }
            } else {
                item.style.animation = 'bounce 0.5s';
                setTimeout(() => { item.style.animation = ''; }, 500);
                playWrongSound();
                let hintText = `Oops! That starts with '${item.dataset.letter}' not '${targetLetter}'!`;
                let hint = document.getElementById('hint');
                hint.innerText = hintText;
                hint.style.display = 'block';
                setTimeout(() => { hint.style.display = 'none'; }, 3000);
            }
        }

        function nextLevel() {
            currentLetterIndex++;
            if (currentLetterIndex >= letters.length) {
                alert('Congratulations! You packed the backpack for all letters A-Z!');
                currentLetterIndex = 0;
            }
            targetLetter = letters[currentLetterIndex];
            timeLeft = 60;
            score = 0;
            requiredCorrect = 0;
            document.getElementById('progress').innerText = `Packed: 0/${requiredCorrect}`;
            startGame();
        }
    </script>
</body>
</html>
